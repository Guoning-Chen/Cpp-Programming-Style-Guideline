# C++编程风格指南

# 1 简介

该指南包含了C++开发社区中对于C++编程的常用建议。

这些建议的来源包括：一些资源中的现有标准、个人经验、<u>本地需求</u>以及参考资料[1]~[4]。

我们之所以提出新的指南而不是简单遵循上述内容是有一些原因的。主要是因为上述内容太宽泛，需要建立更具体的规范（尤其是命名规范）。而且该指南采用了独特的排版，在<u>检查项目代码</u>的过程中使用起来要比其它指南方便得多。另外令人有些困惑的是，编程建议经常将代码风格问题和编程技术问题弄混。本文档主要关注代码风格而不包含任何与C++技术相关的建议。想了解更多有关c++编程风格的内容，请参考[C++编程实践指南](http://www.geosoft.no/development/cpppractice.html)。

尽管集成开发环境（IDE）通过<u>权限可视化</u>、代码着色、自动排版等功能可以提高代码可读性，但编程人员从来都不应该依赖这些特性。源代码应该总是被放到比编写代码的IDE更重要的位置，尽可能提升其独立于IDE的可读性。

# 1.1 建议的排版

所有建议按照主题进行了分组，同时对其进行标号，便于回顾。

建议使用的排版如下：

| 序号. 对该建议的简要描述       |
| ------------------------------ |
| 举例                           |
| 该建议的出发点、背景和其它信息 |

第3部分的内容很重要。编程标准和指南容易引发“宗教战争”，因此说明建议的使用背景很重要。

[^“宗教战争”]: 原文为religious wars，个人理解为分不清对或错、无意义的争论，因为每个人都有自己的编程习惯。

## 1.2 建议的重要性

该指南中的**must**、**should**和**can**都有特殊的含义。（如果建议中包含）**must（必须）**代表该建议必须遵循；**should（应该）**代表强烈推荐；**can（可以）**代表一般建议。

## 2 整体建议

| 1. 只要能够提升可读性，允许采用不同于该指南的做法。          |
| ------------------------------------------------------------ |
|                                                              |
| 建议的意义在于提升代码的可读性，从而有助于阅读者理解代码，提高代码的维护性和代码质量。一份指南很难适用于所有情况，编程者应该灵活应对。 |

| 2. 如果你个人抵触该指南的某项建议，可以不采纳。              |
| ------------------------------------------------------------ |
|                                                              |
| 撰写指南并不是为了强制个人使用某种特定的代码风格。<u>一些有经验的编程者通常希望采用像该指南一样的风格，但是有自己的风格并推荐给其他人，通常会使得其他人开始**思考**编程风格并反思他们自己的习惯</u>。<br>另一方面，通过使用编程风格指南，没有经验的新手更容易快速熟悉编程术语。 |

# 3 命名规范

（译注：以下的命名规范中其实综合了**[驼峰命名法Camel-Case](https://baike.baidu.com/item/%E9%AA%86%E9%A9%BC%E5%91%BD%E5%90%8D%E6%B3%95/7794053?fromtitle=%E9%A9%BC%E5%B3%B0%E5%91%BD%E5%90%8D%E6%B3%95&fromid=7560610&fr=aladdin)**中的**大驼峰Upper Camel Case**和**小驼峰lower Camel Case**，可以通过百度了解一下。）

## 3.1 通用命名规范

| 3. 【must】类名中所有单词的首字母必须大写（相当于大驼峰）。 |
| :---------------------------------------------------------- |
| `Line`，`SavingAccount`                                     |
| C++开发社区中的通用做法。                                   |

| 4. 【must】变量的名称中第一个单词必须小写，其余大写（相当于小驼峰）。 |
| :----------------------------------------------------------- |
| `line`，`savingsAccount`                                     |
| C++开发社区中的通用做法。使得变量区别于各种类的名称，有效解决如`Line line`这种声明中潜在的命名冲突。 |

| 5. 【must】常量（包括枚举量）的名称中所有字母都必须大写，并用下划线分开。 |
| :----------------------------------------------------------- |
| `MAX_ITERATIONS`, `COLOR_RED`, `PI`                          |
| C++开发社区中的通用做法。通常应该尽可能避免使用常量。在大部分情况下，用**method（类的成员函数）**代替是更好的选择：<br>`int getMaxIterations() // 而不是MAX_ITERATIONS = 25`<br/>`{`<br>        `return 25;`<br>`}`<br>这样既容易阅读，又能保证和<u>类的成员变量</u>统一接口。 |

| 6. 【must】方法或函数的名称必须包含动词且首字母小写、其余大写（小驼峰） |
| :----------------------------------------------------------- |
| `getName()`, `computeTotalWidth()`                           |
| C++开发社区中的通用做法。虽然和变量的命名方式相同，但函数本身的特征（译注：函数体、参数列表等）已经足以将它和变量区别开来。 |

| 7. 【should】命名空间的名称中的字母应该全部小写。            |
| :----------------------------------------------------------- |
| `model::analyzer`, `io::iomanager`, `common::math::geometry` |
| C++开发社区中的通用做法。                                    |

| 8. 【should】模板类的名称应该是一个大写英文字母。            |
| :----------------------------------------------------------- |
| `template<class T> ..`.<br/>`template<class C, class D> ...` |
| C++开发社区中的通用做法。使得模板类的名称比其它名称都要显眼。 |

| 9.  【must】当用于命名的时候，缩写词汇只有首字母可以大写 [4] |
| :----------------------------------------------------------- |
| `exportHtmlSource(); // 而不是: exportHTMLSource();`<br/>`openDvdPlayer(); // 而不是: openDVDPlayer();` |
| 如果将缩写词全部大写，将会破坏上述命名规范。<u>这种类型的变量</u>就只能命名为`dVD`，`hTML`等等，可读性显然不好。另一个问题在例子中已经说明：当名称中包含多个单词的时候，（如果将缩写词全部大写）可读性会严重降低，不再容易分辨出缩写词之后的单词。 |

| 10. 【should】应该一直通过 :: 操作符来使用全局变量。    |
| :------------------------------------------------------ |
| `::mainWindow.open()`, `::applicationContext.getName()` |
| 通常应该减少使用全局变量。考虑用<u>单个对象</u>来代替。 |

| 11. 【should】类的私有成员应该加下划线                       |
| :----------------------------------------------------------- |
| `class SomeClass {`<br>`private:`<br>        `int length_;`<br>`}` |
| 除了名称和类型之外，变量的**作用域**是最重要的特征。利用下划线来表明其作用域容易将类的成员变量和本地变量区别开来。这之所以很关键是因为类的成员变量比成员函数更重要，要特殊对待。<br>使用下划线带来的另一个好处是可以很好地解决如何给<u>setter成员函数</u>和构造函数的参数命名的问题：<br>（译注：个人认为原文的setter methods应该是指给类中的成员变量赋值的一类成员函数）<br>`void setDepth (int depth)`<br>`{`<br>        `depth_ = depth;`<br>`}`<br>将下划线作为前缀还是后缀是一个问题。这两种做法都很常见，但更推荐后者（译注：即作为后缀），因为似乎最完整地保留了名称的可读性。<br>值得注意的是——区分变量的作用域很久以来都是有争议的话题。不过现在这种做法似乎正逐渐被人们所接受，在专业开发社区中正逐渐成为一种惯例。 |

| 12. 【should】<u>通用变量</u>的名称应该和它的类型相同。      |
| :----------------------------------------------------------- |
| `void setTopic(Topic* topic) // 而不是: void setTopic(Topic* value)`<br/>                                                          `// 而不是: void setTopic(Topic* aTopic)`<br/>                                                          `// 而不是: void setTopic(Topic* t)`<br/>`void connect(Database* database) // 而不是: void connect(Database* db)`<br/>                                                                     `// 而不是: void connect (Database* oracleDB)` |
| 通过减少术语和名称的数量来降低代码的复杂度。同时根据变量名就很容易推断出它所属的类。<br>如果因为一些原因，该惯例并不**适合**你使用的场景，这很可能说明你选择了一个不合适的类名。<br>非通用变量通常扮演某种**角色**，通常可以结合他们各自的角色和所属的类给他们命名：<br>`Point startingPoint, centerPoint;`<br/>`Name loginName;` |

（译注：这里的通用变量我理解为出现在多个函数的参数列表中的形参）

# 7 参考资料

[1] Code Complete, Steve McConnell - Microsoft Press

[2] [Programming in C++, Rules and Recommendations, M Henricson, e. Nyquist, Ellemtel (Swedish telecom)](http://www.doc.ic.ac.uk/lab/cplus/c%2b%2b.rules/)

[3] [Wildfire C++ Programming Style, Keith Gabryelski, Wildfire Communications Inc.](www.wildfire.com/~ag/Engineering/Development/C++Style/)

[4] [C++ Coding Standard, Todd Hoff](http://www.possibility.com/Cpp/CppCodingStandard.html)

[5] [Doxygen documentation system](http://www.stack.nl/~dimitri/doxygen/index.html)